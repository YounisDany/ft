<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ Ù†Øµ</title>
    <script src="https://unpkg.com/siriwave/dist/siriwave.umd.min.js"></script>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        #siri-container {
            width: 100%;
            height: 200px;
            background-color: #fff;
            border-radius: 10px;
            margin: 20px auto;
            display: none; /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¬Ø© Ø­ØªÙ‰ ÙŠØ¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
        }
        .controls {
            margin-top: 20px;
        }
        button {
            padding: 15px 20px;
            font-size: 18px;
            margin: 5px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .record {
            background-color: #DC3545;
            color: white;
        }
        .stop {
            background-color: #007BFF;
            color: white;
            display: none; /* Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø­ØªÙ‰ ÙŠØ¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
        }
        .input-container {
            margin-top: 20px;
        }
        input {
            padding: 10px;
            font-size: 16px;
            width: 300px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ Ù†Øµ</h1>
    
    <div class="input-container">
        <input type="text" id="text-input" placeholder="Ø³Ø¬Ù„ ÙƒÙ„Ø§Ù…Ùƒ Ù‡Ù†Ø§..." />
        <button class="record" id="start-record">ğŸ¤ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
        <button class="stop" id="stop-record">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
    </div>

    <div id="siri-container"></div>

    <script>
        let siriWave = new SiriWave({
            container: document.getElementById("siri-container"),
            width: window.innerWidth * 0.9, 
            height: 200,
            style: "ios9",
            speed: 0.1,
            amplitude: 1,
            autostart: false
        });

        let audioContext;
        let analyser;
        let microphone;
        let dataArray;

        // Web Speech API (Speech Recognition)
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = "ar-SA";  // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„ØºØ© Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
        recognition.continuous = true;
        recognition.interimResults = true;

        recognition.onresult = (event) => {
            let transcript = '';
            for (let i = event.resultIndex; i < event.results.length; i++) {
                transcript += event.results[i][0].transcript;
            }
            document.getElementById("text-input").value = transcript;  // ÙˆØ¶Ø¹ Ø§Ù„Ù†Øµ ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        };

        recognition.onerror = (event) => {
            console.error("Ø­Ø¯Ø« Ø®Ø·Ø£:", event.error);
        };

        document.getElementById("start-record").addEventListener("click", async () => {
            try {
                // Ø·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

                // Ø¥Ù†Ø´Ø§Ø¡ AudioContext Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØª
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(analyser);

                analyser.fftSize = 256;
                let bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);

                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆØ¬Ø© ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ø­Ø±ÙƒØ©
                document.getElementById("siri-container").style.display = "block";
                siriWave.start();

                function updateWave() {
                    analyser.getByteFrequencyData(dataArray);
                    let volume = dataArray.reduce((a, b) => a + b, 0) / bufferLength;
                    siriWave.setAmplitude(volume / 50); // ØªØºÙŠÙŠØ± Ø³Ø¹Ø© Ø§Ù„Ù…ÙˆØ¬Ø© Ø­Ø³Ø¨ Ø§Ù„ØµÙˆØª
                    requestAnimationFrame(updateWave);
                }

                updateWave();

                // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                document.getElementById("start-record").style.display = "none";
                document.getElementById("stop-record").style.display = "inline-block";

                // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
                recognition.start();
            } catch (error) {
                alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†.");
                console.error(error);
            }
        });

        document.getElementById("stop-record").addEventListener("click", () => {
            if (audioContext) {
                audioContext.close();
                siriWave.stop();
                document.getElementById("siri-container").style.display = "none";
            }

            // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.getElementById("start-record").style.display = "inline-block";
            document.getElementById("stop-record").style.display = "none";

            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
            recognition.stop();
        });
    </script>

</body>
</html>